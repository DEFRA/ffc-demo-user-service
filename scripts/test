#!/usr/bin/env sh

set -e
projectRoot="$(a="/$0"; a=${a%/*}; a=${a:-.}; a=${a#/}/; cd "$a/.." || return; pwd)"

(
  cd "${projectRoot}"

  # Guarantee clean environment
  docker-compose \
    -f docker-compose.yaml \
    -f docker-compose.test.yaml \
     down -v

  # Run tests
  docker-compose \
    -f docker-compose.yaml \
    -f docker-compose.test.yaml \
    run ffc-demo-user-service

  # Clean up
  docker-compose \
    -f docker-compose.yaml \
    -f docker-compose.test.yaml \
     down -v
)
